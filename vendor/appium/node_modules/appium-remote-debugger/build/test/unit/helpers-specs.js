require('source-map-support').install();

'use strict';

var _defineProperty = require('babel-runtime/helpers/define-property')['default'];

var _slicedToArray = require('babel-runtime/helpers/sliced-to-array')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _libHelpers = require('../../lib/helpers');

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var expect = _chai2['default'].expect;
_chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

describe('helpers', function () {
  describe('appInfoFromDict', function () {
    it('should return the id and entry for a dict', function () {
      var dict = {
        WIRApplicationIdentifierKey: '42',
        WIRApplicationNameKey: 'App Name',
        WIRApplicationBundleIdentifierKey: 'app.name',
        WIRIsApplicationProxyKey: 'false',
        WIRHostApplicationIdentifierKey: '43'
      };

      var _appInfoFromDict = (0, _libHelpers.appInfoFromDict)(dict);

      var _appInfoFromDict2 = _slicedToArray(_appInfoFromDict, 2);

      var id = _appInfoFromDict2[0];
      var entry = _appInfoFromDict2[1];

      id.should.equal(dict.WIRApplicationIdentifierKey);
      entry.id.should.equal(dict.WIRApplicationIdentifierKey);
      entry.name.should.equal(dict.WIRApplicationNameKey);
      entry.bundleId.should.equal(dict.WIRApplicationBundleIdentifierKey);
      entry.isProxy.should.equal(dict.WIRIsApplicationProxyKey === 'true');
      entry.hostId.should.equal(dict.WIRHostApplicationIdentifierKey);
    });
  });
  describe('getDebuggerAppKey', function () {
    it('should return the app key for the bundle', function () {
      var appDict = _defineProperty({}, '42', {
        bundleId: 'io.appium.bundle'
      });
      (0, _libHelpers.getDebuggerAppKey)('io.appium.bundle', '8.3', appDict).should.equal('42');
    });
    it('should return the app key for the bundle when proxied', function () {
      var _appDict2;

      var appDict = (_appDict2 = {}, _defineProperty(_appDict2, '42', {
        bundleId: 'io.appium.bundle',
        isProxy: false
      }), _defineProperty(_appDict2, '43', {
        bundleId: 'io.appium.proxied.bundle',
        isProxy: true,
        hostId: '42'
      }), _appDict2);
      (0, _libHelpers.getDebuggerAppKey)('io.appium.bundle', '8.3', appDict).should.equal('43');
    });
    it('should return undefined when there is no appropriate app', function () {
      expect((0, _libHelpers.getDebuggerAppKey)('io.appium.bundle', '8.3', {})).to.not.exist;
    });
  });
  describe('pageArrayFromDict', function () {
    var basePageDict = {
      1: {
        WIRTitleKey: 'Appium/welcome',
        WIRTypeKey: 'WIRTypeWeb',
        WIRURLKey: 'http://127.0.0.1:4723/welcome',
        WIRPageIdentifierKey: 1,
        WIRConnectionIdentifierKey: 'e777f792-c41e-4e5d-8722-68393af663b2'
      }
    };
    it('should return a valid page array', function () {
      var pageArray = (0, _libHelpers.pageArrayFromDict)(basePageDict);
      pageArray.should.have.length(1);
    });
    it('should not count WIRTypeWeb entries', function () {
      var pageDict = _lodash2['default'].defaults({
        2: {
          WIRTypeKey: 'WIRTypeJavaScript'
        }
      }, basePageDict);
      var pageArray = (0, _libHelpers.pageArrayFromDict)(pageDict);
      pageArray.should.have.length(1);
    });
  });
  describe('checkParams', function () {
    it('should not return error when not missing parameters', function () {
      expect((0, _libHelpers.checkParams)({ one: 'first', two: 'second', three: 'third' })).to.not.exist;
    });
    it('should return error when parameter is missing', function () {
      var errors = (0, _libHelpers.checkParams)({ one: 'first', two: null, three: 'third' });
      errors.should.have.length(1);
      errors[0].should.equal('two');
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvdW5pdC9oZWxwZXJzLXNwZWNzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7MEJBRW1GLG1CQUFtQjs7b0JBQ3JGLE1BQU07Ozs7OEJBQ0ksa0JBQWtCOzs7O3NCQUMvQixRQUFROzs7O0FBRXRCLElBQUksTUFBTSxHQUFHLGtCQUFLLE1BQU0sQ0FBQztBQUN6QixrQkFBSyxNQUFNLEVBQUUsQ0FBQztBQUNkLGtCQUFLLEdBQUcsNkJBQWdCLENBQUM7O0FBRXpCLFFBQVEsQ0FBQyxTQUFTLEVBQUUsWUFBTTtBQUN4QixVQUFRLENBQUMsaUJBQWlCLEVBQUUsWUFBTTtBQUNoQyxNQUFFLENBQUMsMkNBQTJDLEVBQUUsWUFBTTtBQUNwRCxVQUFJLElBQUksR0FBRztBQUNULG1DQUEyQixFQUFFLElBQUk7QUFDakMsNkJBQXFCLEVBQUUsVUFBVTtBQUNqQyx5Q0FBaUMsRUFBRSxVQUFVO0FBQzdDLGdDQUF3QixFQUFFLE9BQU87QUFDakMsdUNBQStCLEVBQUUsSUFBSTtPQUN0QyxDQUFDOzs2QkFDZ0IsaUNBQWdCLElBQUksQ0FBQzs7OztVQUFsQyxFQUFFO1VBQUUsS0FBSzs7QUFDZCxRQUFFLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsMkJBQTJCLENBQUMsQ0FBQztBQUNsRCxXQUFLLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLDJCQUEyQixDQUFDLENBQUM7QUFDeEQsV0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBQ3BELFdBQUssQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsaUNBQWlDLENBQUMsQ0FBQztBQUNwRSxXQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLHdCQUF3QixLQUFLLE1BQU0sQ0FBQyxDQUFDO0FB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Q0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQzdCLFlBQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO0tBQy9CLENBQUMsQ0FBQztHQUNKLENBQUMsQ0FBQztDQUNKLENBQUMsQ0FBQyIsImZpbGUiOiJ0ZXN0L3VuaXQvaGVscGVycy1zcGVjcy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIHRyYW5zcGlsZTptb2NoYVxuXG5pbXBvcnQgeyBwYWdlQXJyYXlGcm9tRGljdCwgY2hlY2tQYXJhbXMsIGFwcEluZm9Gcm9tRGljdCwgZ2V0RGVidWdnZXJBcHBLZXkgfSBmcm9tICcuLi8uLi9saWIvaGVscGVycyc7XG5pbXBvcnQgY2hhaSBmcm9tICdjaGFpJztcbmltcG9ydCBjaGFpQXNQcm9taXNlZCBmcm9tICdjaGFpLWFzLXByb21pc2VkJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5cbmxldCBleHBlY3QgPSBjaGFpLmV4cGVjdDtcbmNoYWkuc2hvdWxkKCk7XG5jaGFpLnVzZShjaGFpQXNQcm9taXNlZCk7XG5cbmRlc2NyaWJlKCdoZWxwZXJzJywgKCkgPT4ge1xuICBkZXNjcmliZSgnYXBwSW5mb0Zyb21EaWN0JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIHRoZSBpZCBhbmQgZW50cnkgZm9yIGEgZGljdCcsICgpID0+IHtcbiAgICAgIGxldCBkaWN0ID0ge1xuICAgICAgICBXSVJBcHBsaWNhdGlvbklkZW50aWZpZXJLZXk6ICc0MicsXG4gICAgICAgIFdJUkFwcGxpY2F0aW9uTmFtZUtleTogJ0FwcCBOYW1lJyxcbiAgICAgICAgV0lSQXBwbGljYXRpb25CdW5kbGVJZGVudGlmaWVyS2V5OiAnYXBwLm5hbWUnLFxuICAgICAgICBXSVJJc0FwcGxpY2F0aW9uUHJveHlLZXk6ICdmYWxzZScsXG4gICAgICAgIFdJUkhvc3RBcHBsaWNhdGlvbklkZW50aWZpZXJLZXk6ICc0MydcbiAgICAgIH07XG4gICAgICBsZXQgW2lkLCBlbnRyeV0gPSBhcHBJbmZvRnJvbURpY3QoZGljdCk7XG4gICAgICBpZC5zaG91bGQuZXF1YWwoZGljdC5XSVJBcHBsaWNhdGlvbklkZW50aWZpZXJLZXkpO1xuICAgICAgZW50cnkuaWQuc2hvdWxkLmVxdWFsKGRpY3QuV0lSQXBwbGljYXRpb25JZGVudGlmaWVyS2V5KTtcbiAgICAgIGVudHJ5Lm5hbWUuc2hvdWxkLmVxdWFsKGRpY3QuV0lSQXBwbGljYXRpb25OYW1lS2V5KTtcbiAgICAgIGVudHJ5LmJ1bmRsZUlkLnNob3VsZC5lcXVhbChkaWN0LldJUkFwcGxpY2F0aW9uQnVuZGxlSWRlbnRpZmllcktleSk7XG4gICAgICBlbnRyeS5pc1Byb3h5LnNob3VsZC5lcXVhbChkaWN0LldJUklzQXBwbGljYXRpb25Qcm94eUtleSA9PT0gJ3RydWUnKTtcbiAgICAgIGVudHJ5Lmhvc3RJZC5zaG91bGQuZXF1YWwoZGljdC5XSVJIb3N0QXBwbGljYXRpb25JZGVudGlmaWVyS2V5KTtcbiAgICB9KTtcbiAgfSk7XG4gIGRlc2NyaWJlKCdnZXREZWJ1Z2dlckFwcEtleScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiB0aGUgYXBwIGtleSBmb3IgdGhlIGJ1bmRsZScsICgpID0+IHtcbiAgICAgIGxldCBhcHBEaWN0ID0ge1xuICAgICAgICBbJzQyJ106IHtcbiAgICAgICAgICBidW5kbGVJZDogJ2lvLmFwcGl1bS5idW5kbGUnXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBnZXREZWJ1Z2dlckFwcEtleSgnaW8uYXBwaXVtLmJ1bmRsZScsICc4LjMnLCBhcHBEaWN0KS5zaG91bGQuZXF1YWwoJzQyJyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gdGhlIGFwcCBrZXkgZm9yIHRoZSBidW5kbGUgd2hlbiBwcm94aWVkJywgKCkgPT4ge1xuICAgICAgbGV0IGFwcERpY3QgPSB7XG4gICAgICAgIFsnNDInXToge1xuICAgICAgICAgIGJ1bmRsZUlkOiAnaW8uYXBwaXVtLmJ1bmRsZScsXG4gICAgICAgICAgaXNQcm94eTogZmFsc2VcbiAgICAgICAgfSxcbiAgICAgICAgWyc0MyddOiB7XG4gICAgICAgICAgYnVuZGxlSWQ6ICdpby5hcHBpdW0ucHJveGllZC5idW5kbGUnLFxuICAgICAgICAgIGlzUHJveHk6IHRydWUsXG4gICAgICAgICAgaG9zdElkOiAnNDInXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBnZXREZWJ1Z2dlckFwcEtleSgnaW8uYXBwaXVtLmJ1bmRsZScsICc4LjMnLCBhcHBEaWN0KS5zaG91bGQuZXF1YWwoJzQzJyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gdW5kZWZpbmVkIHdoZW4gdGhlcmUgaXMgbm8gYXBwcm9wcmlhdGUgYXBwJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KGdldERlYnVnZ2VyQXBwS2V5KCdpby5hcHBpdW0uYnVuZGxlJywgJzguMycsIHt9KSkudG8ubm90LmV4aXN0O1xuICAgIH0pO1xuICB9KTtcbiAgZGVzY3JpYmUoJ3BhZ2VBcnJheUZyb21EaWN0JywgKCkgPT4ge1xuICAgIGxldCBiYXNlUGFnZURpY3QgPSB7XG4gICAgICAxOiB7XG4gICAgICAgIFdJUlRpdGxlS2V5OiAnQXBwaXVtL3dlbGNvbWUnLFxuICAgICAgICBXSVJUeXBlS2V5OiAnV0lSVHlwZVdlYicsXG4gICAgICAgIFdJUlVSTEtleTogJ2h0dHA6Ly8xMjcuMC4wLjE6NDcyMy93ZWxjb21lJyxcbiAgICAgICAgV0lSUGFnZUlkZW50aWZpZXJLZXk6IDEsXG4gICAgICAgIFdJUkNvbm5lY3Rpb25JZGVudGlmaWVyS2V5OiAnZTc3N2Y3OTItYzQxZS00ZTVkLTg3MjItNjgzOTNhZjY2M2IyJ1xuICAgICAgfVxuICAgIH07XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gYSB2YWxpZCBwYWdlIGFycmF5JywgKCkgPT4ge1xuICAgICAgbGV0IHBhZ2VBcnJheSA9IHBhZ2VBcnJheUZyb21EaWN0KGJhc2VQYWdlRGljdCk7XG4gICAgICBwYWdlQXJyYXkuc2hvdWxkLmhhdmUubGVuZ3RoKDEpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgbm90IGNvdW50IFdJUlR5cGVXZWIgZW50cmllcycsICgpID0+IHtcbiAgICAgIGxldCBwYWdlRGljdCA9IF8uZGVmYXVsdHMoe1xuICAgICAgICAyOiB7XG4gICAgICAgICAgV0lSVHlwZUtleTogJ1dJUlR5cGVKYXZhU2NyaXB0J1xuICAgICAgICB9XG4gICAgICB9LCBiYXNlUGFnZURpY3QpO1xuICAgICAgbGV0IHBhZ2VBcnJheSA9IHBhZ2VBcnJheUZyb21EaWN0KHBhZ2VEaWN0KTtcbiAgICAgIHBhZ2VBcnJheS5zaG91bGQuaGF2ZS5sZW5ndGgoMSk7XG4gICAgfSk7XG4gIH0pO1xuICBkZXNjcmliZSgnY2hlY2tQYXJhbXMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBub3QgcmV0dXJuIGVycm9yIHdoZW4gbm90IG1pc3NpbmcgcGFyYW1ldGVycycsICgpID0+IHtcbiAgICAgIGV4cGVjdChjaGVja1BhcmFtcyh7b25lOiAnZmlyc3QnLCB0d286ICdzZWNvbmQnLCB0aHJlZTogJ3RoaXJkJ30pKS50by5ub3QuZXhpc3Q7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZXJyb3Igd2hlbiBwYXJhbWV0ZXIgaXMgbWlzc2luZycsICgpID0+IHtcbiAgICAgIGxldCBlcnJvcnMgPSBjaGVja1BhcmFtcyh7b25lOiAnZmlyc3QnLCB0d286IG51bGwsIHRocmVlOiAndGhpcmQnfSk7XG4gICAgICBlcnJvcnMuc2hvdWxkLmhhdmUubGVuZ3RoKDEpO1xuICAgICAgZXJyb3JzWzBdLnNob3VsZC5lcXVhbCgndHdvJyk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
